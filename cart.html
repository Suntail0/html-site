<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Coșul meu - Couture du Jour</title>
  <link rel="stylesheet" href="styles.css">
  <script src="cart.js" defer></script>
  <script src="showcart.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const cartContents = JSON.parse(localStorage.getItem('cart')) || [];
      const checkoutContainer = document.querySelector('.checkout-container');
      const couponContainer = document.querySelector('.coupon-container');
      const cartContentsDiv = document.querySelector('#cart-contents');
      const totalPriceElement = document.querySelector('#total-price');
      let totalPrice = 0;
      let discount = 0;

      // Render cart items
      cartContents.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'cart-item';
        itemDiv.innerHTML = `
          <span>${item.name}</span>
          <span>${item.price.toFixed(2)} RON</span>
        `;
        cartContentsDiv.appendChild(itemDiv);
        totalPrice += item.price;
      });

      // Update total price
      totalPriceElement.textContent = `Total: ${totalPrice.toFixed(2)} RON`;

      // Hide "Finalizează Comanda" button if cart is empty
      if (cartContents.length === 0) {
        checkoutContainer.style.display = 'none';
      }

      // Handle coupon code
      document.querySelector('#apply-coupon').addEventListener('click', function () {
        const couponInput = document.querySelector('#coupon-code').value.trim();
        const discountMessage = document.querySelector('.discount-message');
        const discountDiv = document.querySelector('#discount-item');

        if (couponInput === 'FRAMIPO3') { // Example coupon code
          discount = totalPrice * 0.15; // Calculate 15% discount
          discountMessage.textContent = 'Felicitări! Ai primit o reducere de 15%.';
          discountMessage.style.color = 'green';

          // Display discount as a negative price item
          discountDiv.innerHTML = `
            <span>Reducere (FRAMIPO3)</span>
            <span>-${discount.toFixed(2)} RON</span>
          `;
          discountDiv.style.display = 'block';

          // Update total price with discount
          totalPriceElement.textContent = `Total: ${(totalPrice - discount).toFixed(2)} RON`;
        } else {
          discountMessage.textContent = 'Codul de reducere este invalid.';
          discountMessage.style.color = 'red';

          // Hide discount item
          discountDiv.style.display = 'none';

          // Reset total price
          totalPriceElement.textContent = `Total: ${totalPrice.toFixed(2)} RON`;
        }
      });
    });
  </script>
</head>
<body>
  <div class="top-ribbon">
    <img src="images/logo.png" width="108" height="192" class="logo" alt="Logo">
    <span class="ribbon-title">Couture du Jour</span>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="cart.html">Cart</a></li>
        <li><a href="women.html">Women</a></li>
        <li><a href="men.html">Men</a></li>
        <li>
          <form class="search-bar" id="search-form" action="search.html" method="GET">
            <input type="text" id="search-input" name="query" placeholder="Caută produse..." required>
          </form>
        </li>
      </ul>
    </nav>
  </div>
  <main>
    <h1>Coșul meu</h1>
    <div id="cart-contents"></div>
    <div id="discount-item" class="cart-item" style="display: none;"></div>
    <p id="total-price" class="total-price"></p>
    <div class="coupon-container">
      <label for="coupon-code">Cod reducere:</label>
      <input type="text" id="coupon-code" placeholder="Introdu codul de reducere">
      <button id="apply-coupon">Aplică</button>
      <p class="discount-message"></p>
    </div>
    <div class="checkout-container">
      <a href="pay.html" class="checkout-btn">Finalizează Comanda</a>
    </div>
  </main>
</body>
</html>